import{H3Event as b,getRequestURL as W,getResponseHeaders as j,getRequestWebStream as O,getRequestHeaders as N,eventHandler as F}from"h3";import{getContext as z}from"unctx";import{AsyncLocalStorage as U}from"node:async_hooks";import{isPlainArray as J,isPlainObject as $,defer as Q,useRouter as f,ScriptOnce as _,pick as V,createControlledPromise as Z,RouterProvider as G,createMemoryHistory as X,useRouterState as g,createRootRoute as Y,Outlet as K,ScrollRestoration as ee,createFileRoute as te,lazyRouteComponent as re,lazyFn as ne,createRouter as oe}from"@tanstack/react-router";import{jsxs as h,Fragment as y,jsx as i}from"react/jsx-runtime";import*as S from"react";import{createElement as q}from"react";import x from"jsesc";import se from"tiny-invariant";import{Transform as ae,PassThrough as ie}from"node:stream";import{isbot as E}from"isbot";import R from"react-dom/server";import{Context as I}from"@tanstack/react-cross-context";import{createPortal as ce}from"react-dom";function ue(e,t,r){if(!r.router.isServer)return t;r.match.extracted=r.match.extracted||[];const n=r.match.extracted;return H(t,(o,s)=>{const c=o instanceof ReadableStream?"stream":o instanceof Promise?"promise":void 0;if(c){const u={dataType:e,type:c,path:s,id:n.length,value:o,matchIndex:r.match.index};if(n.push(u),c==="stream"){const[l,d]=o.tee();return u.streamState=pe({stream:d}),l}else Q(o)}return o})}function le(e){const t=f(),r=t.state.matches[e.matchIndex];if(!t.isServer)return null;const n=r.extracted,[a,o]=["__beforeLoadContext","loaderData"].map(s=>n?n.reduce((c,u)=>u.dataType!==s?T(c,["temp",...u.path],void 0):c,{temp:r[s]}).temp:r[s]);return h(y,{children:[a!==void 0||o!==void 0||n?.length?i(_,{children:`__TSR__.matches[${e.matchIndex}] = ${x({__beforeLoadContext:t.options.transformer.stringify(a),loaderData:t.options.transformer.stringify(o),extracted:n?Object.fromEntries(n.map(s=>[s.id,V(s,["type","path"])])):{}},{isScriptContext:!0,wrap:!0,json:!0})}; __TSR__.initMatch(${e.matchIndex})`}):null,n?n.map((s,c)=>s.type==="stream"?i(fe,{entry:s},s.id):i(de,{entry:s},s.id)):null]})}function H(e,t,r=[]){if(J(e))return e.map((a,o)=>H(a,t,[...r,`${o}`]));if($(e)){const a={};for(const o in e)a[o]=H(e[o],t,[...r,o]);return a}const n=t(e,r);return n!==e?n:e}function de({entry:e}){return i("div",{className:"tsr-once",children:i(S.Suspense,{fallback:null,children:i(me,{entry:e})})})}function me({entry:e}){if(e.value.status==="pending")throw e.value;return i(_,{children:`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].resolve(${x(e.value.data,{isScriptContext:!0,wrap:!0,json:!0})})`})}function fe({entry:e}){return se(e.streamState,"StreamState should be defined"),i(P,{streamState:e.streamState,children:t=>i(_,{children:t?`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.enqueue(new TextEncoder().encode(${x(t.toString(),{isScriptContext:!0,wrap:!0,json:!0})}))`:`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.close()`})})}function pe({stream:e}){const t={promises:[]},r=e.getReader(),n=a=>(t.promises[a]=Z(),r.read().then(({done:o,value:s})=>{if(o){t.promises[a].resolve(null),r.releaseLock();return}return t.promises[a].resolve(s),n(a+1)}));return n(0).catch(a=>{console.error("stream read error",a)}),t}function P({streamState:e,children:t,__index:r=0}){const n=e.promises[r];if(!n)return null;if(n.status==="pending")throw n;const a=n.value;return h(y,{children:[t(a),i("div",{className:"tsr-once",children:i(S.Suspense,{fallback:null,children:i(P,{streamState:e,__index:r+1,children:t})})})]})}function T(e,t,r){if(t.length===0)return r;const[n,...a]=t;return Array.isArray(e)?e.map((o,s)=>s===Number(n)?T(o,a,r):o):$(e)?{...e,[n]:T(e[n],a,r)}:e}function C(e){e.router.AfterEachMatch=le,e.router.serializer=n=>x(n,{isScriptContext:!0,wrap:!0,json:!0});const t=I.get("TanStackRouterHydrationContext",{}),r=S.useMemo(()=>{var n,a;return{router:e.router.dehydrate(),payload:(a=(n=e.router.options).dehydrate)==null?void 0:a.call(n)}},[e.router]);return i(t.Provider,{value:r,children:i(G,{router:e.router})})}function he(e){let t;const r=A(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(r,{...n,body:e.node.req.body}):new Request(r,{...n,get body(){return t||(t=xe(e),t)}})}function ye(e){return e.web??={request:he(e),url:A(e)},e.web.request}function Se(){return ve()}const k=Symbol("$HTTPEvent");function ge(e){return typeof e=="object"&&(e instanceof b||e?.[k]instanceof b||e?.__is_event__===!0)}function v(e){return function(...t){let r=t[0];if(ge(r))t[0]=r instanceof b||r.__is_event__?r:r[k];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(r=Se(),!r)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(r)}return e(...t)}}const ht=v(N),A=v(W),_e=v(j),xe=v(O);function Re(){return z("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:U})}function ve(){return Re().use().event}function we(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function M(...e){return e.reduce((t,r)=>{const n=we(r);for(const[a,o]of n.entries())t.set(a,o);return t},new Headers)}const be="server-fn-return-type",He="server-fn-payload-type";function Te({createRouter:e,getRouterManifest:t}){return r=>F(async n=>{const a=ye(n),o=new URL(a.url),s=o.href.replace(o.origin,""),c=X({initialEntries:[s]}),u=e();u.serializeLoaderData=ue,t&&(u.manifest=t()),u.update({history:c}),await u.load();const l=Ee({event:n,router:u});return await r({request:a,router:u,responseHeaders:l})})}function Ee(e){e.event.__tsrHeadersSent=!0;let t=M(_e(e.event),{"Content-Type":"text/html; charset=UTF-8"},...e.router.state.matches.map(n=>n.headers));const{redirect:r}=e.router.state;return r&&(t=M(t,r.headers,{Location:r.href})),[be,He].forEach(n=>{t.delete(n)}),t}function Ce(e){const t=L(()=>e.injectedHtml.map(r=>r()).join(""));return new ae({transform(r,n,a){t.transform(r,this.push.bind(this)).then(()=>a()).catch(o=>a(o))},flush(r){t.flush(this.push.bind(this)).then(()=>r()).catch(n=>r(n))}})}function Me(e){const t=L(()=>e.injectedHtml.map(n=>n()).join("")),r=new TextEncoder;return new TransformStream({transform(n,a){return t.transform(n,o=>(a.enqueue(r.encode(o)),!0))},flush(n){return t.flush(a=>(n.enqueue(a),!0))}})}const $e=/(<body)/,qe=/(<\/body>)/,Ie=/(<\/html>)/,Pe=/(<\/[a-zA-Z][\w:.-]*?>)/g,ke=new TextDecoder;function L(e){let t=!1,r="",n="";return{async transform(a,o){const s=r+ke.decode(a),c=s.match($e),u=s.match(qe),l=s.match(Ie);try{if(c&&(t=!0),!t){o(s),r="";return}const d=e();if(u&&l&&u.index<l.index){const m=u.index+u[0].length,p=l.index+l[0].length,w=s.slice(0,m)+d+s.slice(m,p)+s.slice(p);o(w),r=""}else{let m,p=0;for(;(m=Pe.exec(s))!==null;)p=m.index+m[0].length;if(p>0){const w=s.slice(0,p)+d+n;o(w),r=s.slice(p)}else r=s,n+=d}}catch(d){throw console.error(d),d}},async flush(a){r&&a(r)}}}const Ae=async({request:e,router:t,responseHeaders:r})=>{if(typeof R.renderToReadableStream=="function"){const n=await R.renderToReadableStream(i(C,{router:t}),{signal:e.signal,onError(s,c){console.error(s,c)}});E(e.headers.get("User-Agent"))&&await n.allReady;const o=[Me(t)].reduce((s,c)=>s.pipeThrough(c),n);return new Response(o,{status:t.state.statusCode,headers:r})}if(typeof R.renderToPipeableStream=="function"){const n=new ie,a=R.renderToPipeableStream(i(C,{router:t}),{...E(e.headers.get("User-Agent"))?{onAllReady(){a.pipe(n)}}:{onShellReady(){a.pipe(n)}},onShellError(c){throw c}}),s=[Ce(t)].reduce((c,u)=>c.pipe(u),n);return new Response(s,{status:t.state.statusCode,headers:r})}throw new Error("No renderToReadableStream or renderToPipeableStream found in react-dom/server. Ensure you are using a version of react-dom that supports streaming.")};function Le(e){return globalThis.MANIFEST[e]}const De=()=>({routes:{__root__:{filePath:"__root.tsx",children:["/"],preloads:["/_build/assets/client-Cdpw4yTQ.js","/_build/assets/client-8YSTZJQX.js"]},"/":{filePath:"index.tsx"}}});function Be(){const e=De(),t=e.routes.__root__=e.routes.__root__||{};t.assets=t.assets||[];const r=Le("client");return t.assets.push({tag:"script",attrs:{src:r.inputs[r.handler]?.output.path,type:"module",async:!0,suppressHydrationWarning:!0}}),e}function We(){const e=Be();return{...e,routes:Object.fromEntries(Object.entries(e.routes).map(([t,r])=>{const{preloads:n,assets:a}=r;return[t,{preloads:n,assets:a}]}))}}function D({tag:e,attrs:t,children:r}){switch(e){case"title":return i("title",{...t,suppressHydrationWarning:!0,children:r});case"meta":return i("meta",{...t,suppressHydrationWarning:!0});case"link":return i("link",{...t,suppressHydrationWarning:!0});case"style":return i("style",{...t,dangerouslySetInnerHTML:{__html:r}});case"script":return t&&t.src?i("script",{...t,suppressHydrationWarning:!0}):typeof r=="string"?i("script",{...t,dangerouslySetInnerHTML:{__html:r},suppressHydrationWarning:!0}):null;default:return null}}const je=()=>{const e=f(),t=g({select:o=>o.matches.map(s=>s.meta).filter(Boolean)}),r=S.useMemo(()=>{const o=[],s={};let c;return[...t].reverse().forEach(u=>{[...u].reverse().forEach(l=>{if(l.title)c||(c={tag:"title",children:l.title});else{if(l.name){if(s[l.name])return;s[l.name]=!0}o.push({tag:"meta",attrs:{...l}})}})}),c&&o.push(c),o.reverse(),o},[t]),n=g({select:o=>o.matches.map(s=>s.links).filter(Boolean).flat(1).map(s=>({tag:"link",attrs:{...s}}))}),a=g({select:o=>{const s=[];return o.matches.map(c=>e.looseRoutesById[c.routeId]).forEach(c=>{var u,l,d;return(d=(l=(u=e.manifest)==null?void 0:u.routes[c.id])==null?void 0:l.preloads)==null?void 0:d.filter(Boolean).forEach(m=>{s.push({tag:"link",attrs:{rel:"modulepreload",href:m}})})}),s}});return Je([...r,...a,...n],o=>JSON.stringify(o))},Oe=()=>{const e=f(),t=je(),r=S.useContext(I.get("TanStackRouterHydrationContext",{}));return h(y,{children:[i("meta",{name:"tsr-meta"}),t.map((n,a)=>q(D,{...n,key:`tsr-meta-${JSON.stringify(n)}`})),h(y,{children:[i(_,{log:!1,children:`
__TSR__ = {
  matches: [],
  streamedValues: {},
  initMatch: (index) => {
    Object.entries(__TSR__.matches[index].extracted).forEach(([id, ex]) => {
      if (ex.type === 'stream') {
        let controller;
        ex.value = new ReadableStream({
          start(c) { controller = c; }
        })
        ex.value.controller = controller
      } else if (ex.type === 'promise') {
        let r, j
        ex.value = new Promise((r_, j_) => { r = r_, j = j_ })
        ex.resolve = r; ex.reject = j
      }
    })
  },
  cleanScripts: () => {
    document.querySelectorAll('.tsr-once').forEach((el) => {
      el.remove()
    })
  },
}`}),i(_,{children:`__TSR__.dehydrated = ${x(e.options.transformer.stringify(r),{isScriptContext:!0,wrap:!0,json:!0})}`})]}),i("meta",{name:"/tsr-meta"})]})},Ne=({children:e})=>{const t=f(),r=Oe(),[n,a]=S.useState(!1);S[typeof document<"u"?"useLayoutEffect":"useEffect"](()=>{if(typeof document>"u")return;const s=document.head.querySelector('meta[name="tsr-meta"]'),c=document.head.querySelector('meta[name="/tsr-meta"]');let u=s?.nextElementSibling;for(;u&&u!==c;){const l=u.nextElementSibling;u.remove(),u=l}s?.remove(),c?.remove(),a(!0)},[]);const o=h(y,{children:[r,e]});return t.isServer?o:n?ce(o,document.head):null};function Fe({children:e,...t}){return f().isServer?i("html",{children:e}):i(y,{children:e})}function ze({children:e,...t}){return f().isServer?i("head",{children:e}):e}function Ue({children:e,...t}){return f().isServer?i("body",{children:i("div",{id:"root",children:e})}):e}function Je(e,t){const r=new Set;return e.filter(n=>{const a=t(n);return r.has(a)?!1:(r.add(a),!0)})}const Qe=()=>{const e=f(),t=g({select:a=>{const o=[];return a.matches.map(s=>e.looseRoutesById[s.routeId]).forEach(s=>{var c,u,l;return(l=(u=(c=e.manifest)==null?void 0:c.routes[s.id])==null?void 0:u.assets)==null?void 0:l.filter(d=>d.tag==="script").forEach(d=>{o.push({tag:"script",attrs:d.attrs,children:d.children})})}),o}}),{scripts:r}=g({select:a=>({scripts:a.matches.map(o=>o.scripts).filter(Boolean).flat(1).map(({children:o,...s})=>({tag:"script",attrs:{...s,suppressHydrationWarning:!0},children:o}))})}),n=[...r,...t];return i(y,{children:n.map((a,o)=>q(D,{...a,key:`tsr-scripts-${a.tag}-${o}`}))})},B=Y({meta:()=>[{charSet:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{title:"Start Dahl"}],component:Ve});function Ve(){return i(Ze,{children:i(K,{})})}function Ze({children:e}){return h(Fe,{children:[i(ze,{children:i(Ne,{})}),h(Ue,{children:[e,i(ee,{}),i(Qe,{})]})]})}const Ge=()=>import("./index-J6zsPT9Q.js"),Xe=()=>import("./index-J6zsPT9Q.js"),Ye=te("/")({component:re(Xe,"component"),loader:ne(Ge,"loader")}),Ke=Ye.update({path:"/",getParentRoute:()=>B}),et=B.addChildren({IndexRoute:Ke});function tt(){return oe({routeTree:et})}const yt=Te({createRouter:tt,getRouterManifest:We})(Ae);export{Ye as R,ve as a,ht as b,Le as g,yt as h,ye as t};
